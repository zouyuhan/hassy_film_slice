# Hassy Film Slice

一个用于自动分割（哈苏 X1/X5）扫描底片条成单独相框的 Python 工具。

## 背景

当使用如哈苏 X1/X5 等扫描仪扫描底片时，需要将整条底片送入扫描仪，例如：
- 120 格式 6x6 底片扫描结果为包含 3 张相框的条带
- 135 格式底片扫描结果为包含 6x2（12 张）相框的条带

此工具能够自动检测并将这些扫描条带分割成单独的相框图像，同时保留原始图像质量和元数据。

## 功能特点

- 自动检测扫描底片条中的相框边界
- 支持水平和垂直方向的底片条
- 处理 8 位和 16 位 TIFF/JPG/PNG 图像
- 保留原始图像质量
- 支持批量处理多个文件和目录

## 安装

### 要求

- Python 3.6+
- OpenCV (cv2)
- NumPy

```bash
pip install numpy opencv-python
```

## 使用方法

### 基本用法

```bash
python hassy_film_slicer.py 输入文件.tif
```

### 处理整个目录

```bash
python hassy_film_slicer.py 输入目录
```

### 高级选项

```bash
python hassy_film_slicer.py 输入文件.tif --white_threshold 240 --black_threshold 15
```

#### 参数说明

- `white_threshold`：取值范围 0-255（8/16位图像）。高于此阈值的像素被视为白色。默认值为 240（8位图像）或按比例缩放的16位图像对应值。
- `black_threshold`：取值范围 0-255（8/16位图像）。低于此阈值的像素被视为黑色。默认值为 15（8位图像）或按比例缩放的16位图像对应值。

调整这些阈值可以帮助改善不同曝光水平或对比度扫描图像的帧检测效果。

## 工作原理

1. 工具加载扫描图像（8位/16位 tiff）
2. 使用投影分析检测相框边界：
   - 将图像转换为灰度
   - 应用阈值处理以识别黑色分隔线
   - 分析水平和垂直投影以定位相框边界
3. 将原始图像分割成单独的相框
4. 将每个相框保存为单独的 TIFF 文件，保留原始质量和元数据

## 输出

输出文件使用以下模式命名：`{原始文件名}_frame_{编号}.tif` 